# Firestore Schema Setup — Phase 1

## Overview

This document describes the Firestore collections, document structure, and security rules for the multi-league platform-neutral schema introduced in Phase 1.

## Collections

### `/users/{uid}`

One document per Firebase Auth user.

| Field | Type | Description |
|---|---|---|
| `email` | string | User's email |
| `displayName` | string | Display name |
| `createdAt` | Timestamp | Document creation time |
| `sleeperUserId` | string? | Set after Sleeper account linking |
| `sleeperUsername` | string? | Set after Sleeper account linking |
| `espnLeagueIds` | string[]? | Manually saved ESPN league IDs |

### `/leagues/{leagueId}`

Document ID format: plain numeric for Sleeper (e.g. `"123456"`), `"espn_XXXXX"` for ESPN.

| Field | Type | Description |
|---|---|---|
| `platform` | `'sleeper'` \| `'espn'` | Fantasy platform |
| `platformLeagueId` | string | Raw ID as used by the platform's API |
| `name` | string | League name |
| `season` | number | NFL season year |
| `editorUid` | string | Primary editor's Firebase UID |
| `coEditorUids` | string[] | Co-editor Firebase UIDs |
| `privacy` | `'public'` \| `'private'` | Defaults to `'public'` |
| `createdAt` | Timestamp | Document creation time |

### `/leagues/{leagueId}/newsletters/{weekNumber}`

| Field | Type | Description |
|---|---|---|
| `status` | `'draft'` \| `'published'` | Publication status |
| `publishedAt` | Timestamp \| null | When published |
| `sections` | string[] | Ordered section identifiers |
| `editorNotes` | string | Free-form editor notes |

### `/leagues/{leagueId}/weekData/{weekNumber}`

Auto-generated JSON cache of weekly stats.

| Field | Type | Description |
|---|---|---|
| `matchups` | object | Matchup results |
| `standings` | object | Current standings |
| `awards` | object | Weekly awards |
| `leaderboard` | object | Leaderboard data |

## Security Rules

- **Users**: Authenticated users can read/write only their own `/users/{uid}` document.
- **Leagues**: Publicly readable. Only the `editorUid` or members of `coEditorUids` can create/update/delete.
- **Newsletters & WeekData**: Publicly readable. Writable by the parent league's editor or co-editors.

## Important Notes

- **ESPN credentials** (`espn_s2` / `SWID`) are **never** stored in Firestore. Use `localStorage` only.
- **Submissions** (`/leagues/{leagueId}/newsletters/{weekNumber}/submissions/`) are Phase 3 — not set up yet.
- Privacy defaults to `public` for Phase 1.

## Initial Setup

1. Deploy security rules:
   ```bash
   firebase deploy --only firestore:rules
   ```

2. The first user document is created automatically when a user signs up (call `createUser` from `src/services/firestoreCrud.ts`).

3. Create a league document via the UI or by calling `createLeague`:
   ```ts
   import { createLeague } from './src/services/firestoreCrud';

   // Sleeper league
   await createLeague("123456", {
     platform: "sleeper",
     platformLeagueId: "123456",
     name: "The Offensive Line",
     season: 2025,
     editorUid: "<firebase-uid>",
     coEditorUids: [],
   });

   // ESPN league
   await createLeague("espn_98765", {
     platform: "espn",
     platformLeagueId: "98765",
     name: "ESPN League Name",
     season: 2025,
     editorUid: "<firebase-uid>",
     coEditorUids: [],
   });
   ```

4. WeekData documents are auto-generated by the data pipeline — no manual creation needed.

## TypeScript Types

All document interfaces are defined in `src/types/firestore.ts`. Import them:

```ts
import type { UserDoc, LeagueDoc, NewsletterDoc, WeekDataDoc } from './types/firestore';
```
